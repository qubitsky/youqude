<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bilibili Animated Banner</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      .animated-banner {
        min-height: 155px;
        height: 9.375vw;
        width: 100vw;
        min-width: 999px;
        overflow: hidden;
        position: relative;
      }
      .layer {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>
  <body>
    <div data-v-66241fcf="" data-v-cd8268ae="" class="animated-banner">
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/c12c6ceaa5f78de17cd94bb0ad325339b2386ee8.png"
          data-height="360"
          data-width="9666"
          height="180"
          width="4833"
          style="
            transform: scale(1) translate(0px, -15px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/4d5ddb371f6d710cf0222a5d0cef46ea3ed5901c.png"
          data-height="360"
          data-width="9666"
          height="180"
          width="4833"
          style="
            transform: scale(1) translate(1100px, 0px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/c7a1dbf9bbc09c1f867b14a141c4e2f07c4b228d.png"
          data-height="360"
          data-width="3523"
          height="162"
          width="1585"
          style="
            transform: scale(1) translate(675px, 0px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/d605a7076d5fe89d0d7e3d6219bffe4000033a09.png"
          data-height="360"
          data-width="2938"
          height="176"
          width="1439"
          style="
            transform: scale(1) translate(-637px, 0px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/8d947f22c6a67b8a5d2fbe1424ca2a946802e729.png"
          data-height="139"
          data-width="556"
          height="62"
          width="250"
          style="
            transform: scale(1) translate(607.5px, 45px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/65a860abda015ed247d48b1bcc5cbb9ce725d050.png"
          data-height="302"
          data-width="734"
          height="84"
          width="205"
          style="
            transform: scale(1) translate(252px, 36.4px) rotate(0deg);
            opacity: 0;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/963685e7d82d27ba5e8187680814a2d548b5adbe.png"
          data-height="180"
          data-width="1757"
          height="125"
          width="1229"
          style="
            transform: scale(1) translate(112px, 14px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/6a6e6e52a18a7731645aa1d93b1d74f2f628f77a.png"
          data-height="116"
          data-width="1757"
          height="81"
          width="1229"
          style="
            transform: scale(1) translate(-350px, 49px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/3969636231e7668ec91985bb147c89a6b69021c7.png"
          data-height="346"
          data-width="497"
          height="138"
          width="198"
          style="
            transform: scale(1) translate(-240px, 16px) rotate(0deg);
            opacity: 0;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/9af4cdc3c81e01522fc4df82a5b7cfa8b03b6b5b.png"
          data-height="256"
          data-width="146"
          height="102"
          width="58"
          style="
            transform: scale(1) translate(-340px, 32px) rotate(0deg);
            opacity: 0;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/4d8514308bd6673b215cdb1aadbf12891d784672.png"
          data-height="254"
          data-width="602"
          height="114"
          width="270"
          style="
            transform: scale(1) translate(-90px, 13.5px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/9b4f18f9f18c8dca17ba6c0b46a1dcedb649c82b.png"
          data-height="360"
          data-width="4277"
          height="180"
          width="2138"
          style="
            transform: scale(1) translate(100px, 0px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/b24c872ae1ef34ebe794d1631a50b57fbdb0a482.png"
          data-height="327"
          data-width="933"
          height="147"
          width="419"
          style="
            transform: scale(1) translate(216px, 13.5px) rotate(0deg);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/45031fa60ea6084886e80ca9e906803f9a3221b1.png"
          data-height="353"
          data-width="740"
          height="211"
          width="444"
          style="
            transform: scale(1) translate(2100px, 0px) rotate(0deg);
            filter: blur(2px);
            opacity: 1;
          "
        />
      </div>
      <div class="layer">
        <img
          src="./resources/bilibili-home_files/17a00335345ecb9f5439069ee2d069772a9cede3.png"
          data-height="360"
          data-width="1916"
          height="180"
          width="958"
          style="
            transform: scale(1) translate(-1000px, 0px) rotate(0deg);
            filter: blur(1px);
            opacity: 1;
          "
        />
      </div>
      <canvas
        width="1440"
        height="155"
        style="position: absolute; top: 0px; left: 0px"
      ></canvas>
    </div>
    <script>
      const banner = document.querySelector(".animated-banner");
      const layers = banner.querySelectorAll(".layer");
      const imgs = Array.prototype.map.call(
        layers,
        (layer) => layer.firstElementChild
      );
      const TRANSLATE_REG = /(?<=translate\()[.\-\d]+/;
      const initTransforms = imgs.map((img) => {
        const transformStr = img.style.transform;
        const matched = transformStr.match(TRANSLATE_REG);
        const translateY = matched ? parseFloat(matched[0]) : 0;
        return [transformStr, translateY];
      });
      let startX = 0;
      banner.addEventListener("mouseenter", (e) => {
        startX = e.offsetX;
      });
      banner.addEventListener("mousemove", (e) => {
        if (!startX) return;
        const diffX = e.offsetX - startX;
        animateDiffX(diffX);
      });
      banner.addEventListener("mouseleave", () => {
        startX = 0;
        animateDiffX(0, 200);
      });
      let ref = null;
      function transformImgs(n) {
        imgs.forEach((img, index) => {
          const [str, v] = initTransforms[index];
          const transform = str.replace(
            TRANSLATE_REG,
            v - (index + 1) * n * 0.1
          );
          img.style.transform = transform;
        });
      }
      function animateDiffX(n, interval) {
        if (ref) {
          window.cancelAnimationFrame(ref);
          ref = null;
        }
        if (!interval) {
          ref = window.requestAnimationFrame(() => {
            transformImgs(n);
            animateDiffX._diffX = n;
          });
        }
        const startTime = Date.now();
        ref = window.requestAnimationFrame(() => {
          const currTime = Date.now();
          const ratio = Math.min((currTime - startTime) / interval, 1);
          const to = animateDiffX._diffX + (n - animateDiffX._diffX) * ratio;
          transformImgs(to);
          animateDiffX._diffX = to;
          animateDiffX(n, interval * (1 - ratio));
        });
      }
    </script>
  </body>
</html>
